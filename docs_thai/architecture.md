# ภาพรวมสถาปัตยกรรม Gemini CLI

เอกสารนี้ให้ภาพรวมระดับสูงของสถาปัตยกรรม Gemini CLI

## องค์ประกอบหลัก

Gemini CLI ประกอบด้วยแพ็คเกจหลักสองตัว พร้อมด้วยชุดเครื่องมือที่สามารถใช้งานได้โดยระบบในการจัดการอินพุตบรรทัดคำสั่ง:

1.  **แพ็คเกจ CLI (`packages/cli`):**
    - **วัตถุประสงค์:** ประกอบด้วยส่วนที่ผู้ใช้เห็นของ Gemini CLI เช่น การจัดการอินพุตเริ่มต้นของผู้ใช้ การแสดงผลลัพธ์สุดท้าย และการจัดการประสบการณ์ผู้ใช้โดยรวม
    - **ฟังก์ชันหลักที่อยู่ในแพ็คเกจ:**
      - [การประมวลผลอินพุต](./cli/commands.md)
      - การจัดการประวัติ
      - การแสดงผลการเรนเดอร์
      - [การปรับแต่งธีมและ UI](./cli/themes.md)
      - [การตั้งค่าการกำหนดค่า CLI](./cli/configuration.md)

2.  **แพ็คเกจหลัก (`packages/core`):**
    - **วัตถุประสงค์:** ทำหน้าที่เป็นแบ็กเอนด์สำหรับ Gemini CLI รับคำขอที่ส่งจาก `packages/cli` จัดระเบียบการโต้ตอบกับ Gemini API และจัดการการดำเนินการของเครื่องมือที่มีอยู่
    - **ฟังก์ชันหลักที่อยู่ในแพ็คเกจ:**
      - API client สำหรับการสื่อสารกับ Google Gemini API
      - การสร้างและจัดการพรอมต์
      - ลอจิกการลงทะเบียนและดำเนินการเครื่องมือ
      - การจัดการสถานะสำหรับการสนทนาหรือเซสชัน
      - การกำหนดค่าฝั่งเซิร์ฟเวอร์

3.  **เครื่องมือ (`packages/core/src/tools/`):**
    - **วัตถุประสงค์:** โมดูลแต่ละตัวที่ขยายความสามารถของโมเดล Gemini ช่วยให้สามารถโต้ตอบกับสภาพแวดล้อมในเครื่อง (เช่น ระบบไฟล์ คำสั่งเชลล์ การดึงข้อมูลเว็บ)
    - **การโต้ตอบ:** `packages/core` เรียกใช้เครื่องมือเหล่านี้ตามคำขอจากโมเดล Gemini

## การไหลของการโต้ตอบ

การโต้ตอบทั่วไปกับ Gemini CLI เป็นไปตามขั้นตอนนี้:

1.  **อินพุตของผู้ใช้:** ผู้ใช้พิมพ์พรอมต์หรือคำสั่งลงในเทอร์มินัล ซึ่งจัดการโดย `packages/cli`
2.  **คำขอไปยังหลัก:** `packages/cli` ส่งอินพุตของผู้ใช้ไปยัง `packages/core`
3.  **ประมวลผลคำขอ:** แพ็คเกจหลัก:
    - สร้างพรอมต์ที่เหมาะสมสำหรับ Gemini API อาจรวมถึงประวัติการสนทนาและนิยามเครื่องมือที่มีอยู่
    - ส่งพรอมต์ไปยัง Gemini API
4.  **การตอบสนองของ Gemini API:** Gemini API ประมวลผลพรอมต์และส่งคืนการตอบสนอง การตอบสนองนี้อาจเป็นคำตอบโดยตรงหรือคำขอให้ใช้เครื่องมือที่มีอยู่อย่างใดอย่างหนึ่ง
5.  **การดำเนินการเครื่องมือ (ถ้าใช้):**
    - เมื่อ Gemini API ขอเครื่องมือ แพ็คเกจหลักจะเตรียมพร้อมที่จะดำเนินการ
    - หากเครื่องมือที่ขอสามารถแก้ไขระบบไฟล์หรือดำเนินคำสั่งเชลล์ ผู้ใช้จะได้รับรายละเอียดของเครื่องมือและอาร์กิวเมนต์เสียก่อน และผู้ใช้ต้องอนุมัติการดำเนินการ
    - การดำเนินการแบบอ่านอย่างเดียว เช่น การอ่านไฟล์ อาจไม่จำเป็นต้องได้รับการยืนยันจากผู้ใช้อย่างชัดเจนเพื่อดำเนินการต่อ
    - เมื่อได้รับการยืนยันแล้ว หรือหากไม่จำเป็นต้องยืนยัน แพ็คเกจหลักจะดำเนินการที่เกี่ยวข้องภายในเครื่องมือที่เกี่ยวข้อง และผลลัพธ์จะถูกส่งกลับไปยัง Gemini API โดยแพ็คเกจหลัก
    - Gemini API ประมวลผลผลลัพธ์เครื่องมือและสร้างการตอบสนองสุดท้าย
6.  **การตอบสนองไปยัง CLI:** แพ็คเกจหลักส่งการตอบสนองสุดท้ายกลับไปยังแพ็คเกจ CLI
7.  **แสดงให้ผู้ใช้:** แพ็คเกจ CLI จัดรูปแบบและแสดงการตอบสนองให้ผู้ใช้ในเทอร์มินัล

## หลักการออกแบบหลัก

- **โมดูลาร์:** การแยก CLI (frontend) จาก Core (backend) ช่วยให้สามารถพัฒนาแยกกันได้และการขยายในอนาคต (เช่น frontend ที่แตกต่างกันสำหรับ backend เดียวกัน)
- **ความสามารถในการขยาย:** ระบบเครื่องมือได้รับการออกแบบให้สามารถขยายได้ ช่วยให้สามารถเพิ่มความสามารถใหม่ได้
- **ประสบการณ์ผู้ใช้:** CLI มุ่งเน้นการให้ประสบการณ์เทอร์มินัลที่หลากหลายและโต้ตอบได้
